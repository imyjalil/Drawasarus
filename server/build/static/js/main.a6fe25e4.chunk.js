(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{2:function(e,t){e.exports={JOIN_GAME:"join",CREATE_GAME:"create",DRAW:"draw",GUESS:"guess",WORD_SELECT:"wordselect",CONNECT:"connect",SOCKET:"socket",GAME_ID:"gameId",CLIENT_ID:"clientId",NAME:"name",WS_CONNECT:"ws_connect",WS_DISCONNECT:"ws_disconnect",WS_SEND_MESSAGE:"ws_message",UPDATE_PLAYER_LIST:"update_player_list",REMOVE_PLAYER:"remove_player",MUTE:"mute",UNMUTE:"unmute",SET_LOCAL_STREAM:"localstream",SET_REMOTE_STREAM:"remotestream",SET_REMOTE_CORDS:"cords"}},42:function(e,t,n){},65:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},7:function(e,t,n){"use strict";n.r(t),n.d(t,"wsConnect",(function(){return c})),n.d(t,"wsDisconnect",(function(){return r})),n.d(t,"wsSendMessage",(function(){return o}));var a=n(2),c=function(e){return{type:a.WS_CONNECT,host:e}},r=function(e){return{type:a.WS_DISCONNECT,host:e}},o=function(e){return console.log("dispatching sendmessage"),{type:a.WS_SEND_MESSAGE,payload:e}}},70:function(e,t,n){},73:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(19),r=n.n(c),o=(n(42),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,74)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))}),s=n(8),i=n(21),l=n(18),d=n(4),u=n(2),m=n.n(u),b={gameId:"",name:"",clientId:"",chatEvent:null};var g,p=n(36),f=n(12),j=n.n(f),v=n(37),O=n(16),h=n(22),E=n.n(h),I=function(e){return{type:u.CLIENT_ID,payload:{clientId:e}}},C=function(e){return{type:u.GAME_ID,payload:{gameId:e}}},y=function(e){return{type:u.NAME,payload:{name:e}}},x=function(e){return{type:u.SET_REMOTE_CORDS,payload:{cords:e.cords}}},S=n(7),w={},T={},_={audio:!0,video:!1},k={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]};function N(e){console.log("addLocalTracks:"),console.log(g),g.getTracks().forEach((function(t){e.addTrack(t,g)}))}var M=function(){var e=Object(O.a)(j.a.mark((function e(t,n,a){var c,r,o,s,i,l,d,b,p,f,h;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("event received:"),!t||!t.data){e.next=77;break}if(c=JSON.parse(t.data),console.log(c),!c||!c.method){e.next=77;break}console.log("In event, handler event type:"+c.method),e.t0=c.method,e.next=e.t0===m.a.CONNECT?9:e.t0===m.a.CREATE_GAME?20:e.t0===m.a.JOIN_GAME?24:e.t0===m.a.GUESS?27:e.t0===m.a.SET_REMOTE_CORDS?29:"prevClients"===e.t0?31:e.t0===m.a.UPDATE_PLAYER_LIST?54:e.t0===m.a.REMOVE_PLAYER?57:"webRTCOffer"===e.t0?59:"webRTCAnswer"===e.t0?71:"sendIceCandidate"===e.t0?73:76;break;case 9:return r=c.clientId,console.log("dispatch client id"),n(I(r)),o={method:m.a.JOIN_GAME,clientId:r,gameId:a.user.gameId,name:a.user.name},n(Object(S.wsSendMessage)(o)),e.next=16,navigator.mediaDevices.getUserMedia(_);case 16:return g=e.sent,console.log("localStream fetched:"),console.log(g),e.abrupt("break",77);case 20:return s=c.gameId,n(C(s)),sessionStorage.setItem("gameId",s),e.abrupt("break",77);case 24:return i=c.name,console.log(i,"Joined"),e.abrupt("break",77);case 27:return n((M=c,{type:u.GUESS,payload:{chatEvent:M}})),e.abrupt("break",77);case 29:return n(x(c)),e.abrupt("break",77);case 31:l=c.clients;case 32:if(null!=g&&void 0!=g){e.next=37;break}return e.next=35,new Promise((function(e){return setTimeout(e,100)}));case 35:e.next=32;break;case 37:d=Object(v.a)(l),e.prev=38,p=j.a.mark((function e(){var t,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.value,console.log("--\x3e new player",t),console.log(a),c=new RTCPeerConnection(k),w[t]=c,N(c),c.ontrack=function(e){console.log("9848022338 prevclients"),console.log(e);var n=document.createElement("video");n.autoplay="autoplay",n.srcObject=e.streams[0],document.getElementById("audioEvents").appendChild(n),T[t]=e.streams[0]},c.onicecandidate=function(e){if(e.candidate){var c={method:"sendIceCandidate",senderId:a.user.clientId,receiverId:t,label:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate};n(Object(S.wsSendMessage)(c))}},console.log("before offer creation"),e.next=11,Object(O.a)(j.a.mark((function e(){var r,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("in offer creation"),e.prev=1,e.next=4,c.createOffer();case 4:r=e.sent,c.setLocalDescription(r),console.log("offer creation succeeded"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log("error in setting session desc");case 12:o={method:"webRTCOffer",sdp:r,senderId:a.user.clientId,receiverId:t},console.log("sending offer websocket"),n(Object(S.wsSendMessage)(o));case 15:case"end":return e.stop()}}),e,null,[[1,9]])})))();case 11:e.sent;case 12:case"end":return e.stop()}}),e)})),d.s();case 41:if((b=d.n()).done){e.next=45;break}return e.delegateYield(p(),"t1",43);case 43:e.next=41;break;case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(38),d.e(e.t2);case 50:return e.prev=50,d.f(),e.finish(50);case 53:return e.abrupt("break",77);case 54:return console.log("updating the playerlist"),n((y=c,{type:u.UPDATE_PLAYER_LIST,payload:y})),e.abrupt("break",77);case 57:return n((E=c.id,{type:u.REMOVE_PLAYER,payload:{id:E}})),e.abrupt("break",77);case 59:return console.log("webrtcoffer"),console.log(c),f=new RTCPeerConnection(k),w[c.senderId]=f,N(f),f.ontrack=function(e){console.log("9848022338 offer"),console.log(e);var t=document.createElement("video");t.autoplay="autoplay",t.srcObject=e.streams[0],document.getElementById("audioEvents").appendChild(t),T[c.senderId]=e.streams[0]},f.onicecandidate=function(e){if(e.candidate){var t={method:"sendIceCandidate",senderId:a.user.clientId,receiverId:c.senderId,label:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate};n(Object(S.wsSendMessage)(t))}},f.setRemoteDescription(new RTCSessionDescription(c.sdp)),e.next=69,Object(O.a)(j.a.mark((function e(){var t,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("in offer creation"),e.prev=1,e.next=4,f.createAnswer();case 4:t=e.sent,f.setLocalDescription(t),console.log("offer creation succeeded"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log("error in setting session desc");case 12:r={method:"webRTCAnswer",sdp:t,senderId:a.user.clientId,receiverId:c.senderId},console.log("sending answer websocket"),n(Object(S.wsSendMessage)(r));case 15:case"end":return e.stop()}}),e,null,[[1,9]])})))();case 69:return e.sent,e.abrupt("break",77);case 71:return w[c.senderId].setRemoteDescription(c.sdp),e.abrupt("break",77);case 73:return h=new RTCIceCandidate({sdpMLineIndex:c.label,candidate:c.candidate}),w[c.senderId].addIceCandidate(h),e.abrupt("break",77);case 76:console.log("other event:"+c.method);case 77:case"end":return e.stop()}var E,y,M}),e,null,[[38,47,50,53]])})));return function(t,n,a){return e.apply(this,arguments)}}(),R=n(2),D=R.WS_CONNECT,A=R.WS_DISCONNECT,L=R.WS_SEND_MESSAGE,P=n(7),G=(P.wsConnect,P.wsDisconnect,function(){var e=null;return function(t){return function(n){return function(a){switch(a.type){case D:console.log("middle ware",D),null!=e&&(e.close(),""),(e=new WebSocket(a.host)).onmessage=function(e){return function(t){M(t,e.dispatch,e.getState())}}(t),e.onclose=function(e){console.log("web socket connection closed")},e.onopen=function(e){console.log("web socket connection opened")};break;case A:console.log("reducer",A),null!=e&&e.close(),e=null,"";break;case L:console.log("sending the message",a.payload),e.send(JSON.stringify(a.payload));break;default:console.log("default action",a.type," not found")}return n(a)}}}}),W={players:[],localStream:null,remoteCords:[0,0,0,0],receivedDrawEvent:!1};var B=Object(l.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.SOCKET:return Object(d.a)(Object(d.a)({},e),{},{ws:t.payload.ws});case u.GAME_ID:return Object(d.a)(Object(d.a)({},e),{},{gameId:t.payload.gameId});case u.CLIENT_ID:return Object(d.a)(Object(d.a)({},e),{},{clientId:t.payload.clientId});case u.NAME:return Object(d.a)(Object(d.a)({},e),{},{name:t.payload.name});case u.GUESS:return console.log(t),Object(d.a)(Object(d.a)({},e),{},{chatEvent:t.payload.chatEvent});default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.UPDATE_PLAYER_LIST:return Object(d.a)(Object(d.a)({},e),{},{players:t.payload.playerlist});case u.REMOVE_PLAYER:return Object(d.a)(Object(d.a)({},e),{},{players:e.players.filter((function(e){return e.id!=t.payload.id}))});case u.SET_REMOTE_CORDS:return Object(d.a)(Object(d.a)({},e),{},{remoteCords:t.payload.cords,receivedDrawEvent:!e.receivedDrawEvent});case u.SET_LOCAL_STREAM:return Object(d.a)(Object(d.a)({},e),{},{localStream:t.payload.stream});case u.SET_REMOTE_STREAM:var n=JSON.parse(JSON.stringify(e.players));return console.log("setremotestream game reducer"),console.log(n),n.forEach((function(e){e.id==t.payload.id&&(e.remoteStream=t.payload.stream)})),Object(d.a)(Object(d.a)({},e),{},{players:n});default:return e}}}),U=[p.a,G()],J=Object(l.d)(B,Object(l.c)(l.a.apply(void 0,U)));console.log("in store",J.getState());var Y=J,V=n(5),F=n(15),H=(n(65),n(1));var K=function(e){var t=Object(a.useState)(!1),n=Object(F.a)(t,2),c=n[0],r=n[1],o=function(){r(!c)};return Object(H.jsxs)("div",{className:"player",children:[Object(H.jsx)("div",{children:e.name}),Object(H.jsx)("div",{children:e.points}),c?Object(H.jsx)("span",{className:"material-icons",onClick:o,children:"volume_off"}):Object(H.jsx)("span",{className:"material-icons",onClick:o,children:"volume_up"})]})};n(67);var q,X,z,Q,Z=function(){Object(s.b)();var e=Object(s.c)((function(e){return e.game.players})).map((function(e){return Object(H.jsx)(K,{name:e.name,points:e.points},e.id)}));return Object(H.jsx)("div",{className:"leader-board-container",children:e})},$=function(){var e=Object(a.useState)(!1),t=Object(F.a)(e,2),n=t[0],c=t[1],r=Object(a.useRef)(null),o=Object(a.useRef)(null),i=Object(s.b)(),l=Object(s.c)((function(e){return{clientId:e.user.clientId,gameId:e.user.gameId,remoteCords:e.game.remoteCords,receivedDrawEvent:e.game.receivedDrawEvent}}));console.log("remote",l.remoteCords),Object(a.useEffect)((function(){var e=r.current;e.width=parseInt(getComputedStyle(document.querySelector("#canvasElement")).getPropertyValue("width")),e.height=window.innerHeight,e.style.width="100%",e.style.height="100%";var t=e.getContext("2d");t.lineCap="round",t.strokeStyle="black",t.lineWidth=2,o.current=t}),[]),Object(a.useEffect)((function(){console.log("remote canvas",l.remoteCords);var e=l.remoteCords,t=e.oldx,n=e.oldy,a=e.newx,c=e.newy;o.current.moveTo(t,n),o.current.lineTo(a,c),o.current.stroke()}),[l.receivedDrawEvent]);var d=function(e){var t=r.current;return{x:e.offsetX*t.width/t.clientWidth|0,y:e.offsetY*t.height/t.clientHeight|0}};return Object(H.jsx)("canvas",{onMouseDown:function(e){var t=e.nativeEvent;o.current.beginPath(),q=d(t).x,X=d(t).y,o.current.moveTo(q,X),console.log("moved to "+q+", "+X),c(!0)},onMouseUp:function(){o.current.closePath(),c(!1)},onMouseMove:function(e){var t=e.nativeEvent;if(n){z=d(t).x,Q=d(t).y,console.log(q,X,z,Q);var a={method:m.a.SET_REMOTE_CORDS,gameId:l.gameId,clientid:l.clientId,cords:[q,X,z,Q]};i(Object(S.wsSendMessage)(a)),o.current.lineTo(z,Q),o.current.stroke(),q=z,X=Q}},ref:r,id:"canvasElement",style:{width:"100%"}})},ee=(n(68),function(){var e=Object(a.useState)(!1),t=Object(F.a)(e,2),n=t[0],c=t[1],r=Object(s.b)(),o=Object(s.c)((function(e){return{clientId:e.user.clientId,name:e.user.name,gameId:e.user.gameId,chatEvent:e.user.chatEvent}}));Object(a.useEffect)((function(){console.log("chatEvent:"),console.log(o.chatEvent),l(o.chatEvent)}),[o.chatEvent]);var i=function(e){null===e&&(e=document.getElementsByClassName("textContainer")[0].value),""!==(e=e.trim())&&(console.log("id:"+o.clientId+" name:"+o.name+"gameId:"+o.gameId),e={method:m.a.GUESS,guessWord:e,clientId:o.clientId,name:o.name,gameId:o.gameId},r(Object(S.wsSendMessage)(e)))},l=function(e){if(e){console.log("addChatMessage message:"),console.log(e);var t=d(e);document.getElementById("chatMessages").innerHTML+=t;var n=document.getElementById("outerContainer");n.scrollTop=n.scrollHeight}else console.log("Invalid message")},d=function(e){var t=e.clientId===o.clientId,n=t?"mine":"their",a="";return t||(a="<span class='senderName'>".concat(e.name,"</span>")),"<li class='message ".concat(n,"'>\n        <div class='messageContainer'>\n            ").concat(a,"\n            <span class='messageBody'>\n                ").concat(e.guessWord,"\n            </span>\n        </div>\n    </li>")},u=function(){c(!n)},b=n?Object(H.jsx)("span",{className:"material-icons micButton",onClick:function(){return u()},children:"mic"}):Object(H.jsx)("span",{className:"material-icons micButton",onClick:function(){return u()},children:"mic_off"});return Object(H.jsxs)("div",{className:"outerContainer",id:"outerContainer",children:[Object(H.jsx)("div",{className:"chatContainer",children:Object(H.jsx)("div",{id:"chatMessages",className:"chatMessages"})}),Object(H.jsx)("footer",{children:Object(H.jsxs)("div",{className:"footerContainer",children:[Object(H.jsx)("input",{className:"textContainer",id:"textInputContainer",placeholder:"Type a message...",onKeyPress:function(e){return"Enter"===e.key?i(e.target.value):null}}),Object(H.jsx)("i",{className:"material-icons sendButton",onClick:function(){return i(null)},children:"send"}),b]})})]})}),te=(n(69),function(e){var t=e.handleClose,n=e.show,a=e.children,c=n?"modal display-block":"modal display-none";return Object(H.jsx)("div",{className:c,children:Object(H.jsxs)("section",{className:"modal-main",children:[a,Object(H.jsx)("input",{type:"text",defaultValue:"name",id:"joinname"}),Object(H.jsx)("button",{onClick:t,children:"Close"})]})})});n(70);var ne=function(){return Object(H.jsxs)("div",{className:"gamePageContainer",children:[Object(H.jsx)("div",{className:"col-sm-2 leaderBoard",children:Object(H.jsx)(Z,{})}),Object(H.jsx)("div",{className:"col-sm-8 canvas",children:Object(H.jsx)($,{})}),Object(H.jsx)("div",{className:"col-sm-2 chat",children:Object(H.jsx)(ee,{})}),Object(H.jsx)("div",{id:"audioEvents"}),Object(H.jsx)(te,{show:!1})]})};var ae=function(){var e=Object(s.b)(),t=Object(V.f)(),n=Object(s.c)((function(e){return{clientId:e.user.clientId,gameId:e.user.gameId,name:e.user.name,isClientCreated:e.user.isClientCreated,isGameCreated:e.user.isGameCreated}})),a=function(){var n=Object(O.a)(j.a.mark((function n(){var a,c,r;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e(y(document.getElementById("name").value)),a=document.getElementById("gameId").value,c={gameId:a},n.next=5,E.a.get("http://localhost:80/isValidGame",{headers:c});case 5:if(r=n.sent,console.log(r.data),r&&r.data&&r.data.valid){n.next=10;break}return alert("Game id is Invalid. Please check again"),n.abrupt("return");case 10:e(C(a)),e(Object(S.wsConnect)("ws://localhost:80/")),t.push("game/"+a);case 13:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(H.jsxs)("div",{className:"LandingPage",children:[Object(H.jsx)("h1",{children:n.clientId}),Object(H.jsx)("input",{type:"text",id:"name",defaultValue:"abc"}),Object(H.jsx)("br",{}),Object(H.jsx)("input",{type:"button",value:"Create",onClick:function(){e(y(document.getElementById("name").value)),e((function(e){return E.a.post("http://localhost:80/create-game").then((function(t){return console.log(t.data),t=t.data,e(C(t.gameId)),"game/".concat(t.gameId)})).catch((function(e){return""}))})).then((function(n){""!=n&&(e(Object(S.wsConnect)("ws://localhost:80/")),console.log(n),t.push(n))}))}}),Object(H.jsx)("br",{}),Object(H.jsx)("input",{type:"text",id:"gameId"}),Object(H.jsx)("br",{}),Object(H.jsx)("input",{type:"button",value:"Join",onClick:a})]})};var ce=function(e){return Object(H.jsxs)(V.c,{children:[Object(H.jsx)(V.a,{exact:!0,path:"/",children:Object(H.jsx)(ae,{props:e})}),Object(H.jsx)(V.a,{path:"/game/:code",children:Object(H.jsx)(ne,{})})]})};r.a.render(Object(H.jsx)(s.a,{store:Y,children:Object(H.jsx)(i.a,{children:Object(H.jsx)("div",{className:"playGroundContainer",children:Object(H.jsx)(ce,{props:Y})})})}),document.getElementById("root")),o()}},[[73,1,2]]]);
//# sourceMappingURL=main.a6fe25e4.chunk.js.map